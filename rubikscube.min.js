domReady(function(){"use strict";var n=document.getElementById("container");var o=document.getElementById("control");var p=false;var q=0,ry=0;var r=0,sy=0;function containerMouseDown(a){if(w)return;a.preventDefault();p=true;r=a.pageX;sy=a.pageY}function containerMouseMove(a){if(w)return;if(p){a.preventDefault();q+=-1*(r-a.pageX);ry+=(sy-a.pageY);r=a.pageX;sy=a.pageY;rotateControl(ry,q)}}function rotateControl(a,b){q=b,ry=a;css(o,{transform:"rotateX("+a+"deg) rotateY("+b+"deg)"})}function containerMouseUp(a){if(w){eVector=offsetXY(a.pageX,a.pageY,y);B=getRotatingDir(y,x,eVector);rotateCubies(y.parentNode)}else{p=false}}addEvent(document.body,"touchmove",function(a){a.preventDefault()});addEvent(n,"mousedown",containerMouseDown);addEvent(n,"mousemove",containerMouseMove);addEvent(n,"touchstart",containerMouseDown);addEvent(n,"touchmove",containerMouseMove);addEvent(n,"mouseup",containerMouseUp);addEvent(n,"touchend",containerMouseUp);var s={front:"white",left:"green",back:"yellow",right:"blue",down:"red",up:"orange"};var t=document.getElementsByClassName("surface");for(var i=0;i<t.length;i++){css(t[i],{backgroundColor:s[t[i].dataset.surface]})}rotateControl(-35,45);var u={width:614,height:614,maxScale:1.0,minScale:0.5};css(document.body,{transform:"scale("+computeScale(u)+")"});var v=document.getElementsByClassName("cubie");var w=false;var x=null,eVector=null;var y=null;function surfaceMouseDown(a){if(p||w)return;w=true;y=this;x=offsetXY(a.pageX,a.pageY,y);a.preventDefault()}function surfaceMouseUp(a){if(p)return;eVector=offsetXY(a.pageX,a.pageY,y);B=getRotatingDir(y,x,eVector);rotateCubies(y.parentNode);a.stopPropagation()}function surfaceTouchEnd(a){if(p)return;eVector=offsetXY(a.changedTouches[0].pageX,a.changedTouches[0].pageY,y);B=getRotatingDir(y,x,eVector);rotateCubies(y.parentNode);a.stopPropagation()}for(var i=0;i<t.length;i++){addEvent(t[i],"mousedown",surfaceMouseDown);addEvent(t[i],"mouseup",surfaceMouseUp);addEvent(t[i],"touchstart",surfaceMouseDown);addEvent(t[i],"touchend",surfaceTouchEnd)}function getRotatingDir(a,b,c){var d=((c.x-b.x)*100).toFixed(1);var e=((c.y-b.y)*100).toFixed(1);if(d==0&&e==0)return"";var f=Math.atan2(-1*e,d)*180/Math.PI;f+=(f<0)?360:0;var g="";switch(a.dataset.surface){case"front":if(f>45&&f<=135)g="XCCW";else if(f>135&&f<=225)g="YCW";else if(f>225&&f<=315)g="XCW";else g="YCCW";break;case"right":if(f>45&&f<=135)g="ZCW";else if(f>135&&f<=225)g="YCW";else if(f>225&&f<=315)g="ZCCW";else g="YCCW";break;case"back":if(f>45&&f<=135)g="XCW";else if(f>135&&f<=225)g="YCW";else if(f>225&&f<=315)g="XCCW";else g="YCCW";break;case"left":if(f>45&&f<=135)g="ZCCW";else if(f>135&&f<=225)g="YCW";else if(f>225&&f<=315)g="ZCW";else g="YCCW";break;case"down":if(f>45&&f<=135)g="XCW";else if(f>135&&f<=225)g="ZCCW";else if(f>225&&f<=315)g="XCCW";else g="ZCW";break;case"up":if(f>45&&f<=135)g="XCW";else if(f>135&&f<=225)g="ZCW";else if(f>225&&f<=315)g="XCCW";else g="ZCCW";break}return g}function offsetXY(f,g,h){function coords(a){var b=document.createElement('div'),e=[],i;b.style.display="none";a.appendChild(b);for(i=0;i<4;i++){b.style.cssText='display:block;width:0;height:0;position:absolute;left:'+(i%3?100:0)+'%;top:'+(i<2?0:100)+'%;';e[i]=b.getBoundingClientRect()}a.removeChild(b);return e}var e=coords(h),a,d,c;a=[[e[3].top-e[0].top,e[0].top-e[1].top],[e[0].left-e[3].left,e[1].left-e[0].left]];d=(a[0][0]*a[1][1]-a[0][1]*a[1][0]);c=[f-window.pageXOffset-e[0].left,g-window.pageYOffset-e[0].top];return{x:(c[0]*a[0][0]+c[1]*a[1][0])/d,y:(c[0]*a[0][1]+c[1]*a[1][1])/d}}var z=document.getElementById("rotating");var A=[];var B="";var C=[];function rotateCubies(a,b,c){b=b||B;c=c||0.2;if(b=="")return;B=b;var d=b.charAt(0).toUpperCase();C.push({element:a.id,direction:b});A=[];for(var i=0;i<v.length;i++){switch(d){case"X":if(v[i].dataset.x==a.dataset.x)A.push(v[i]);break;case"Y":if(v[i].dataset.y==a.dataset.y)A.push(v[i]);break;case"Z":if(v[i].dataset.z==a.dataset.z)A.push(v[i]);break}}prepareRotatingPane(A);css(z,{animationName:b,animationDuration:c+"s"})}addEvent(z,"AnimationEnd",function(){changeSurfaceColors();css(this,{animationName:""});emptyRotatingPane();B="";A=[];w=false});var D={"00":"20","01":"10","02":"00","10":"21","11":"11","12":"01","20":"22","21":"12","22":"02"};var E={"00":"02","01":"12","02":"22","10":"01","11":"11","12":"21","20":"00","21":"10","22":"20"};var F={left:"left",right:"right",up:"back",back:"down",down:"front",front:"up"};var G={left:"left",right:"right",up:"front",front:"down",down:"back",back:"up"};var H={up:"up",down:"down",left:"front",front:"right",right:"back",back:"left"};var I={up:"up",down:"down",left:"back",back:"right",right:"front",front:"left"};var J={front:"front",back:"back",left:"up",up:"right",right:"down",down:"left"};var K={front:"front",back:"back",left:"down",down:"right",right:"up",up:"left"};function changeSurfaceColors(a){a=a||B;if(a=="")return;var b=a.charAt(0).toUpperCase();var c=(a.substr(1).toUpperCase()=="CW")?true:false;var d=E;if(c==false){d=D}var e=[];for(var i=0;i<A.length;i++){var f=A[i];var g="";switch(b){case"X":var h=d[f.id.charAt(1)+f.id.charAt(3)];g="c"+h.charAt(0)+f.dataset.x+h.charAt(1);break;case"Y":g="c"+d[f.id.substr(1,2)]+f.dataset.y;break;case"Z":g="c"+f.dataset.z+d[f.id.substr(2)];break}var k=document.getElementById(g);e[f.id]=getColors(k)}var l=null;switch(b){case"X":l=(c)?F:G;break;case"Y":l=(c)?H:I;break;case"Z":l=(c)?J:K;break}for(var i=0;i<A.length;i++){var f=A[i];var m=f.children;for(var j=0;j<m.length;j++){css(m[j],{backgroundColor:e[f.id][l[m[j].dataset.surface]]})}}}function getColors(a){var b={front:null,back:null,left:null,right:null,up:null,down:null};var c=a.children;for(var i=0;i<c.length;i++){b[c[i].dataset.surface.toLowerCase()]=c[i].style.backgroundColor}return b}function prepareRotatingPane(a){a=a||A;for(var i=0;i<a.length;i++){a[i].parentNode.removeChild(a[i]);z.appendChild(a[i])}}function emptyRotatingPane(){while(z.firstChild){var a=z.firstChild;z.removeChild(a);z.parentNode.appendChild(a)}}});